<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>SheetCraft AI</title>
        <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script defer src="polyfill.js"></script><script defer src="taskpane.js"></script></head>
    <body>
        <main id="app-body" style="display: none;">
            <header class="app-header">
                <div class="brand">
                    <div class="logo" id="logo-icon"></div>
                    <h1>SheetCraft <span class="highlight-text">AI</span></h1>
                </div>
                <div class="header-actions">
                    <button id="docs-toggle" class="btn-icon" title="What can I do?"></button>
                    <button id="settings-toggle" class="btn-icon" title="Settings"></button>
                </div>
            </header>

            <!-- Docs Panel -->
            <div id="docs-panel" class="panel" style="display: none;">
                <h3>What can SheetCraft AI do?</h3>
                <div class="docs-grid">
                    <div class="doc-item"><span class="doc-icon" data-icon="barChart"></span><div><strong>Charts</strong><p>Create any chart type — column, bar, line, pie, area, scatter, radar, doughnut</p></div></div>
                    <div class="doc-item"><span class="doc-icon" data-icon="table"></span><div><strong>Tables</strong><p>Generate formatted tables, add headers, totals row, styles</p></div></div>
                    <div class="doc-item"><span class="doc-icon" data-icon="paintbrush"></span><div><strong>Formatting</strong><p>Bold, colors, borders, alignment, number formats, merge cells, zebra stripes</p></div></div>
                    <div class="doc-item"><span class="doc-icon" data-icon="formula"></span><div><strong>Formulas</strong><p>SUM, AVERAGE, VLOOKUP, IF, COUNTIF, SUMIF, and any Excel formula</p></div></div>
                    <div class="doc-item"><span class="doc-icon" data-icon="sortAsc"></span><div><strong>Sort & Filter</strong><p>Sort by any column, apply AutoFilter, multi-column sorting</p></div></div>
                    <div class="doc-item"><span class="doc-icon" data-icon="checkSquare"></span><div><strong>Validation</strong><p>Dropdown lists, number constraints, date limits, error alerts</p></div></div>
                    <div class="doc-item"><span class="doc-icon" data-icon="trendUp"></span><div><strong>Conditional Formatting</strong><p>Color scales, data bars, icon sets, highlight rules</p></div></div>
                    <div class="doc-item"><span class="doc-icon" data-icon="snowflake"></span><div><strong>Freeze Panes</strong><p>Freeze header rows or columns for better navigation</p></div></div>
                    <div class="doc-item"><span class="doc-icon" data-icon="columns"></span><div><strong>Worksheets</strong><p>Add, rename, delete, copy sheets, change tab colors</p></div></div>
                    <div class="doc-item"><span class="doc-icon" data-icon="lock"></span><div><strong>Protection</strong><p>Protect/unprotect sheets with custom permissions</p></div></div>
                    <div class="doc-item"><span class="doc-icon" data-icon="search"></span><div><strong>Find & Highlight</strong><p>Search for values and highlight matches</p></div></div>
                    <div class="doc-item"><span class="doc-icon" data-icon="eraser"></span><div><strong>Clean Data</strong><p>Clear formatting, contents, or everything. Remove duplicates</p></div></div>
                </div>
                <p class="docs-hint">Just describe what you need in plain English — SheetCraft handles the rest.</p>
            </div>

            <!-- Settings Panel -->
            <div id="settings-panel" class="panel" style="display: none;">
                <h3>AI Provider</h3>
                
                <div class="form-group">
                    <label for="setting-provider">Provider</label>
                    <select id="setting-provider" class="form-input">
                        <option value="groq">Groq (Cloud)</option>
                        <option value="local">Ollama (Local)</option>
                    </select>
                </div>

                <div id="groq-fields">
                    <div class="form-group">
                        <label for="setting-api-key">API Key</label>
                        <input id="setting-api-key" type="password" class="form-input" placeholder="gsk_..." />
                    </div>
                    <div class="form-group">
                        <label for="setting-groq-model">Model</label>
                        <select id="setting-groq-model" class="form-input">
                            <option value="llama-3.1-8b-instant" selected>Llama 3.1 8B — Fast (131K TPM)</option>
                            <option value="llama-3.3-70b-versatile">Llama 3.3 70B — Smart (12K TPM)</option>
                            <option value="gemma2-9b-it">Gemma 2 9B (15K TPM)</option>
                            <option value="mixtral-8x7b-32768">Mixtral 8x7B (5K TPM)</option>
                        </select>
                    </div>
                </div>

                <div id="local-fields" style="display: none;">
                    <div class="form-group">
                        <label for="setting-base-url">Ollama Host</label>
                        <input id="setting-base-url" type="text" class="form-input" placeholder="http://localhost:11434" />
                    </div>
                    <div class="form-group">
                        <label>Model</label>
                        <div class="model-select-wrapper">
                            <select id="setting-local-model" class="form-input">
                                <option value="" disabled selected>Click refresh →</option>
                            </select>
                            <button id="refresh-models" class="btn-icon btn-refresh" title="Refresh models"></button>
                        </div>
                        <div id="model-status" class="model-status"></div>
                    </div>
                </div>

                <button id="save-settings" class="btn-primary btn-save">Save</button>
            </div>

            <!-- ═══════════════════════════════════════════════════ -->
            <!-- MODE TOGGLE -->
            <!-- ═══════════════════════════════════════════════════ -->
            <div class="mode-toggle">
                <button id="mode-planning" class="mode-tab active" data-mode="planning">
                    <span id="mode-planning-icon"></span>
                    <span>Planning</span>
                </button>
                <button id="mode-agent" class="mode-tab" data-mode="agent">
                    <span id="mode-agent-icon"></span>
                    <span>Agent</span>
                </button>
                <div class="mode-indicator" id="mode-indicator"></div>
            </div>

            <!-- ═══════════════════════════════════════════════════ -->
            <!-- PLANNING MODE (Chat) -->
            <!-- ═══════════════════════════════════════════════════ -->
            <div id="planning-mode" class="mode-content active">
                <!-- Chat Messages Area -->
                <div id="chat-messages" class="chat-messages">
                    <!-- Welcome message -->
                    <div class="chat-welcome">
                        <div class="welcome-icon" id="welcome-sparkle"></div>
                        <h2>What are you working on?</h2>
                        <p>I'm your spreadsheet thinking partner. Ask me about formulas, data strategies, best practices, or let me help you plan your next step.</p>
                        <div class="welcome-suggestions" id="chat-suggestions">
                            <!-- Dynamically populated -->
                        </div>
                    </div>
                </div>

                <!-- Chat Input -->
                <div class="chat-input-area">
                    <div class="chat-input-card">
                        <textarea id="chat-input" placeholder="Ask anything about Excel..." rows="1" spellcheck="false"></textarea>
                        <button id="chat-send" class="btn-send" title="Send message">
                            <span id="chat-send-icon"></span>
                        </button>
                    </div>
                    <div class="chat-footer">
                        <button id="chat-clear" class="btn-text" title="Clear conversation">
                            <span id="chat-clear-icon"></span>
                            <span>Clear</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- ═══════════════════════════════════════════════════ -->
            <!-- AGENT MODE (Execute) -->
            <!-- ═══════════════════════════════════════════════════ -->
            <div id="agent-mode" class="mode-content">
                <div class="content-wrapper">
                    <div class="input-card">
                        <textarea id="prompt-input" placeholder="Describe what you want to do in Excel..." spellcheck="false"></textarea>
                        <div class="card-footer">
                            <span id="cache-badge" class="cache-badge" style="display:none;">⚡ cached</span>
                            <button id="run" class="btn-primary">
                                <span>Execute</span>
                                <span id="run-icon"></span>
                            </button>
                        </div>
                    </div>

                    <!-- Category Tabs for Quick Actions -->
                    <div class="action-categories" id="action-categories">
                        <button class="category-tab active" data-category="cleanup">
                            <span class="cat-icon" data-icon="broom"></span>
                            <span>Cleanup</span>
                        </button>
                        <button class="category-tab" data-category="analysis">
                            <span class="cat-icon" data-icon="pieChart"></span>
                            <span>Analysis</span>
                        </button>
                        <button class="category-tab" data-category="format">
                            <span class="cat-icon" data-icon="palette"></span>
                            <span>Format</span>
                        </button>
                        <button class="category-tab" data-category="templates">
                            <span class="cat-icon" data-icon="fileTemplate"></span>
                            <span>Templates</span>
                        </button>
                    </div>

                    <!-- Quick Actions -->
                    <div id="quick-actions" class="quick-actions"></div>

                    <!-- Skeleton (shown during loading) -->
                    <div id="skeleton" class="skeleton-container" style="display: none;">
                        <div class="skeleton-pill"></div>
                        <div class="skeleton-line w80"></div>
                        <div class="skeleton-line w60"></div>
                    </div>

                    <!-- Status Message -->
                    <div id="status-message" class="status-pill"></div>

                    <!-- Debug -->
                    <div id="debug-section">
                        <details>
                            <summary>
                                <span id="chevron-icon"></span>
                                <span>Generated Code</span>
                            </summary>
                            <pre id="debug-code"></pre>
                        </details>
                    </div>
                </div>
            </div>
        </main>
        
        <section id="sideload-msg" class="sideload-container">
            <!-- Skeleton UI mimicking the real app layout -->
            <div class="sideload-skeleton">
                <!-- Skeleton Header -->
                <div class="sk-header">
                    <div class="sk-brand">
                        <div class="sk-logo sk-shimmer"></div>
                        <div class="sk-title sk-shimmer"></div>
                    </div>
                    <div class="sk-header-actions">
                        <div class="sk-icon-btn sk-shimmer"></div>
                        <div class="sk-icon-btn sk-shimmer"></div>
                    </div>
                </div>

                <!-- Skeleton Mode Toggle -->
                <div class="sk-mode-toggle">
                    <div class="sk-mode-tab sk-shimmer"></div>
                    <div class="sk-mode-tab sk-shimmer"></div>
                </div>

                <!-- Skeleton Welcome -->
                <div class="sk-welcome">
                    <div class="sk-welcome-icon sk-shimmer"></div>
                    <div class="sk-welcome-title sk-shimmer"></div>
                    <div class="sk-welcome-desc sk-shimmer"></div>
                    <div class="sk-welcome-desc short sk-shimmer"></div>
                </div>

                <!-- Skeleton Suggestions -->
                <div class="sk-suggestions">
                    <div class="sk-suggestion sk-shimmer"></div>
                    <div class="sk-suggestion sk-shimmer"></div>
                    <div class="sk-suggestion sk-shimmer"></div>
                    <div class="sk-suggestion sk-shimmer"></div>
                </div>

                <!-- Skeleton Input -->
                <div class="sk-input-area">
                    <div class="sk-input sk-shimmer"></div>
                </div>

                <!-- Loading Status -->
                <div class="sideload-status">
                    <div class="sideload-pulse"></div>
                    <span>Connecting to Excel...</span>
                </div>
            </div>
        </section>
    </body>
</html>
